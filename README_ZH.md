# ScreenCleanerApp 🧹✨

[English](README.md) | 简体中文

一款 macOS 菜单栏应用，让你在清洁 Mac 屏幕时无需担心键盘和触控板的误触。

## ✨ 功能特性

- **一键清洁模式**：通过单击或快捷键快速启动清洁模式
- **全屏黑色遮罩**：覆盖所有已连接的显示器
- **完全输入屏蔽**：清洁模式下拦截所有键盘输入
- **安全退出**：使用自定义快捷键退出（默认：⌘⇧L）
- **全局热键**：在任何应用中快速启动（⌘⇧L）
- **多显示器支持**：自动覆盖所有连接的屏幕
- **菜单栏集成**：简洁、不干扰的界面
- **状态指示**：菜单栏图标实时显示清洁模式状态
- **系统通知**：启动和退出时的友好提示
- **流畅动画**：淡入淡出过渡效果
- **自定义设置**：
  - 开机自动启动
  - 自定义覆盖层颜色（黑色/深灰/白色）
  - 声音效果开关
  - 系统通知开关

## 📋 系统要求

- macOS 13.0 (Ventura) 或更高版本
- 需要授予辅助功能权限（用于键盘拦截）

## 📦 安装方式

### 方式 1：直接下载（推荐）

1. 访问 [Releases 页面](https://github.com/learnor/ScreenCleanerApp/releases)
2. 下载最新版本的 `ScreenCleanerApp-v1.0.0.zip`
3. 解压并将应用拖到"应用程序"文件夹
4. **首次打开**：右键点击应用 → 选择"打开"
5. 在弹出的安全对话框中点击"打开"

### 方式 2：一键安装脚本

```bash
curl -fsSL https://raw.githubusercontent.com/learnor/ScreenCleanerApp/main/scripts/install.sh | bash
```

这个脚本会自动：
- 检查系统版本
- 下载最新版本
- 安装到应用程序文件夹
- 移除隔离属性

### 方式 3：Homebrew Cask

```bash
brew install --cask https://raw.githubusercontent.com/learnor/ScreenCleanerApp/main/homebrew/Casks/screen-cleaner.rb
```

### 从源码构建

1. 克隆或下载此仓库
2. 在 Xcode 中打开 `ScreenCleanerApp.xcodeproj`
3. 构建并运行项目（⌘R）
4. 根据提示授予辅助功能权限

## 🚀 使用方法

### 首次启动

首次启动时，应用会提示你授予辅助功能权限：

1. 在权限对话框中点击"打开设置"
2. 进入"系统设置" → "隐私与安全性" → "辅助功能"
3. 在列表中找到 ScreenCleanerApp 并启用
4. 重启应用

### 启动清洁模式

**方法 1**：点击菜单栏中的 ✨ 图标 → "切换清洁模式"

**方法 2**：在任何地方按 **⌘⇧L**（Command + Shift + L）

### 退出清洁模式

再次按 **⌘⇧L** 即可退出清洁模式并恢复正常操作。

**备用方法**：连续按 9 次 ESC 键（可以有间隔）

⚠️ **重要提示**：清洁模式下，只有退出快捷键能够响应，所有其他输入都会被屏蔽。

### 自定义设置

点击菜单栏图标 → "设置"，你可以：

- **快捷键**：自定义启动和退出快捷键
- **外观**：选择覆盖层颜色（黑色/深灰/白色）
- **行为**：
  - 开机自动启动
  - 启用/禁用声音效果
  - 启用/禁用系统通知
- **权限**：查看和管理辅助功能权限

## 🔧 工作原理

ScreenCleanerApp 使用 macOS 系统 API 提供安全的清洁体验：

1. **全屏窗口**：创建覆盖所有显示器的无边框黑色窗口
2. **键盘拦截**：使用 CGEventTap API 拦截并阻止所有键盘事件
3. **选择性过滤**：只允许退出快捷键组合通过
4. **基于权限**：需要用户通过辅助功能设置明确授权
5. **状态通知**：通过菜单栏图标和系统通知实时反馈

## 📁 技术细节

### 架构

- **语言**：Swift 5.9+
- **UI 框架**：SwiftUI + AppKit
- **最低目标**：macOS 13.0
- **关键技术**：
  - CGEventTap - 键盘拦截
  - NSStatusItem - 菜单栏集成
  - Carbon Event Manager - 全局热键
  - UserNotifications - 系统通知
  - ServiceManagement - 开机启动
  - Combine - 响应式状态更新

### 项目结构

```
ScreenCleanerApp/
├── App/                      # 应用入口
│   ├── ScreenCleanerAppApp.swift
│   ├── AppDelegate.swift     # 菜单栏管理、状态监听
│   └── Info.plist
├── Core/                     # 核心功能
│   ├── CleanModeManager.swift      # 清洁模式协调器
│   ├── FullScreenWindow.swift      # 全屏遮罩窗口
│   ├── KeyboardInterceptor.swift   # 键盘拦截器
│   └── PermissionManager.swift     # 权限管理
├── UI/                       # 用户界面
│   ├── SettingsView.swift          # 设置面板
│   └── HotKeyRecorder.swift        # 快捷键录制器
└── Utilities/                # 工具类
    ├── HotKeyManager.swift         # 全局热键管理
    ├── UserPreferences.swift       # 用户偏好设置
    └── Constants.swift             # 常量定义
```

### 核心组件

#### CleanModeManager（清洁模式管理器）
协调清洁模式的生命周期，管理窗口和键盘拦截，发送系统通知。

#### KeyboardInterceptor（键盘拦截器）
使用 CGEventTap 在系统级别拦截键盘事件。屏蔽除退出组合键外的所有输入。

#### FullScreenWindow（全屏窗口）
自定义 NSWindow 子类，创建覆盖整个屏幕的黑色遮罩，处于最高窗口层级。支持动画淡入淡出。

#### PermissionManager（权限管理器）
处理辅助功能权限的检查和请求。

#### HotKeyManager（热键管理器）
使用 Carbon Event Manager 注册全局键盘快捷键。

#### UserPreferences（用户偏好）
管理所有用户设置，包括快捷键、颜色、声音、通知和开机启动。

## 🔍 故障排除

### 清洁模式无法启动

**问题**：点击"切换清洁模式"没有反应。

**解决方案**：检查辅助功能权限是否已授予：
- 点击菜单栏图标 → 检查权限状态
- 如果需要，点击"授予"前往系统设置
- 在辅助功能设置中启用 ScreenCleanerApp
- 重启应用

### 无法退出清洁模式

**问题**：卡在清洁模式中无法退出。

**解决方案**：
1. **主要方法**：按你设置的退出快捷键（默认：⌘⇧L）
2. **备用方法**：连续按 9 次 ESC 键
3. **强制退出**：如果以上都不行：
   - 按住电源按钮 5 秒强制关机，或
   - 按 Control + ⌘ + 电源键重启 Mac

### 快捷键不工作

**问题**：按快捷键没有触发清洁模式。

**可能原因**：
- 其他应用正在使用相同的快捷键
- 未授予辅助功能权限
- 应用未运行

**解决方案**：
- 检查菜单栏是否有 ✨ 图标，确认应用正在运行
- 确认已授予辅助功能权限
- 在设置中更改快捷键，避免冲突

### 多显示器未覆盖

**问题**：外接显示器没有显示黑色遮罩。

**解决方案**：
- 确保在启动清洁模式前已连接显示器
- 尝试断开并重新连接显示器
- 在更改显示器配置后重启应用

### 菜单栏图标不变色

**问题**：启动清洁模式后菜单栏图标没有变成绿色。

**解决方案**：
- 这是正常现象（可能是系统延迟）
- 清洁模式功能不受影响
- 退出并重新启动应用

## 🔒 隐私与安全

ScreenCleanerApp 注重隐私设计：

- ✅ **无网络访问**：应用完全离线工作
- ✅ **无数据收集**：不收集或传输任何用户数据
- ✅ **开源透明**：所有代码公开可审查
- ✅ **最小权限**：仅请求必要的辅助功能权限
- ✅ **本地运行**：所有数据存储在本地

### 为什么需要辅助功能权限？

辅助功能权限用于使用 CGEventTap API，该 API 允许应用：
- 在系统级别拦截键盘事件
- 在清洁模式下屏蔽不需要的输入
- 检测退出快捷键组合

**重要提示**：此权限功能强大，只应授予可信应用。ScreenCleanerApp 专门用于预期目的，不会记录、传输或滥用键盘输入数据。

## ⚠️ 限制说明

- 某些系统级快捷键无法拦截（如电源按钮、Touch ID）
- 应用必须运行才能使用全局快捷键
- 需要 macOS 13.0 或更高版本
- 首次安装需要右键打开（未签名应用的 macOS 安全限制）

## 🗺️ 未来计划

可能在未来版本中添加的功能：

- [ ] 代码签名和公证（消除安全警告）
- [ ] 多语言支持（更多语言）
- [ ] 更多覆盖层颜色和图案
- [ ] 自动退出计时器
- [ ] 使用统计（可选）
- [ ] 触控板手势退出支持
- [ ] Mac App Store 分发

## 🤝 贡献

欢迎提交问题和拉取请求！

## 📄 开源协议

MIT License - 自由使用、修改和分发。

详见 [LICENSE](LICENSE) 文件。

## 👏 致谢

- 使用 Swift 和 SwiftUI 构建
- 图标：SF Symbols（sparkles）
- 由 Claude 和社区共同创建

## 🆘 支持

遇到问题或有建议？

- 📝 [提交 Issue](https://github.com/learnor/ScreenCleanerApp/issues)
- 💬 [查看讨论](https://github.com/learnor/ScreenCleanerApp/discussions)
- ⭐ 如果觉得有用，请给项目加星！

## 📊 版本历史

### v1.0.0 (2026-02-16)

**初始发布版本**

- ✨ 全屏清洁模式
- ⌨️ 可自定义快捷键
- 🎨 菜单栏状态指示
- 🔔 系统通知
- 🎬 淡入淡出动画
- ⚙️ 丰富的设置选项
- 📦 多种安装方式

查看完整的 [更新日志](CHANGELOG.md)。

---

## 💡 常见问题 (FAQ)

### Q: 这个应用是否记录我的键盘输入？
**A**: 不会。应用只在清洁模式激活时拦截键盘，并且只是简单地屏蔽事件，不记录任何内容。

### Q: 为什么首次打开需要右键点击？
**A**: 因为应用未经过 Apple 代码签名和公证。这是 macOS 的安全机制，保护用户免受未验证软件的潜在风险。

### Q: 会支持更早版本的 macOS 吗？
**A**: 目前最低要求是 macOS 13.0 (Ventura)。支持更早版本需要大量重构工作，暂无计划。

### Q: 可以自定义覆盖层显示的内容吗？
**A**: 当前版本显示简单的提示信息。未来版本可能会支持自定义文本和图案。

### Q: 应用会自动更新吗？
**A**: 当前版本不支持自动更新。你需要手动下载新版本或通过 Homebrew 更新。

---

**免责声明**：此应用需要辅助功能权限才能正常工作。请确保你信任此应用后再授予该权限。始终从官方渠道下载。

**安全提示**：下载后验证 SHA256 校验和以确保文件完整性。校验和文件与发布包一同提供。

---

<div align="center">

**Made with ❤️ for Mac users who care about their screens**

[⬆️ 回到顶部](#screencle anerapp-)

</div>
